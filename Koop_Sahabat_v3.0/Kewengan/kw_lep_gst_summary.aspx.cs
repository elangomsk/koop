using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Data;
using System.Drawing;
using System.Text;
using System.Data.SqlClient;
using Microsoft.Reporting.WebForms;
using System.Globalization;
using System.Configuration;
using System.Web.UI.HtmlControls;
using System.IO;
using System.Web.UI.WebControls.WebParts;
using System.Xml.Linq;
using System.Windows.Forms;
using System.Threading;

public partial class kw_lep_gst_summary : System.Web.UI.Page
{
    
    DBConnection Dblog = new DBConnection();
    string cs = ConfigurationManager.ConnectionStrings["KSAIMBConnectionString"].ConnectionString;
    SqlConnection conn = new SqlConnection(ConfigurationManager.ConnectionStrings["KSAIMBConnectionString"].ConnectionString);
    string conString = ConfigurationManager.ConnectionStrings["KSAIMBConnectionString"].ConnectionString;
    SqlConnection con = new SqlConnection(ConfigurationManager.ConnectionStrings["KSAIMBConnectionString"].ConnectionString);
    DBConnection DBCon = new DBConnection();
    string qry1 = string.Empty, qry2 = string.Empty;
    string sqry1 = string.Empty, sqry2 = string.Empty;
    string level;
    string Status = string.Empty;
    string userid;
    string CommandArgument1 = string.Empty, CommandArgument2 = string.Empty, CommandArgument3 = string.Empty;
    protected void Page_Load(object sender, EventArgs e)
    {
        app_language();
        ScriptManager scriptManager = ScriptManager.GetCurrent(this.Page);
        scriptManager.RegisterPostBackControl(this.Button4);
        scriptManager.RegisterPostBackControl(this.Button2);
        //string script = " $(document).ready(function () { $(" + DropDownList2.ClientID + ").SumoSelect({ selectAll: true });});";
        //ScriptManager.RegisterStartupScript(this, this.GetType(), "", script, true);
        if (!IsPostBack)
        {
            if (Session["New"] != null)
            {
                userid = Session["New"].ToString();
                //bind_gst_type();
            }
            else
            {
                Response.Redirect("../KSAIMB_Login.aspx");
            }
        }
    }
    void app_language()

    {
        if (Session["New"] != null)
        {
            DataTable ste_set = new DataTable();
            ste_set = DBCon.Ora_Execute_table("select * from site_settings where ID IN ('1')");

            DataTable gt_lng = new DataTable();
            gt_lng = DBCon.Ora_Execute_table("select " + Session["site_languaage"].ToString() + " from Ref_language where ID IN ('819','705','1724','64','65','1838','121','1839','15')");

            CultureInfo culinfo = Thread.CurrentThread.CurrentCulture;
            TextInfo txtinfo = culinfo.TextInfo;

            ps_lbl1.Text = txtinfo.ToTitleCase(gt_lng.Rows[4][0].ToString().ToLower());
            ps_lbl2.Text = txtinfo.ToTitleCase(gt_lng.Rows[5][0].ToString().ToLower());
            ps_lbl3.Text = txtinfo.ToTitleCase(gt_lng.Rows[4][0].ToString().ToLower());
            ps_lbl4.Text = txtinfo.ToTitleCase(gt_lng.Rows[6][0].ToString().ToLower()); 
            ps_lbl5.Text = txtinfo.ToTitleCase(gt_lng.Rows[1][0].ToString().ToLower());
            ps_lbl6.Text = txtinfo.ToTitleCase(gt_lng.Rows[2][0].ToString().ToLower());
            ps_lbl7.Text = txtinfo.ToTitleCase(gt_lng.Rows[8][0].ToString().ToLower());
            Button4.Text = txtinfo.ToTitleCase(gt_lng.Rows[3][0].ToString().ToLower());
            Button2.Text = txtinfo.ToTitleCase(gt_lng.Rows[7][0].ToString().ToLower());
            Button1.Text = txtinfo.ToTitleCase(gt_lng.Rows[0][0].ToString().ToLower());
           

        }
        else
        {
            Response.Redirect("../KSAIMB_Login.aspx");
        }
    }
    //void bind_gst_type()
    //{
    //    DataSet Ds = new DataSet();
    //    try
    //    {
    //        string com = "select Ref_kod_cukai,Ref_nama_cukai from KW_Ref_Tetapan_cukai where Status='A'";
    //        SqlDataAdapter adpt = new SqlDataAdapter(com, con);
    //        DataTable dt = new DataTable();
    //        adpt.Fill(dt);
    //        DropDownList2.DataSource = dt;
    //        DropDownList2.DataTextField = "Ref_nama_cukai";
    //        DropDownList2.DataValueField = "Ref_kod_cukai";
    //        DropDownList2.DataBind();
    //        //DropDownList2.Items.Insert(0, new ListItem("--- PILIH ---", ""));
    //    }
    //    catch (Exception ex)
    //    {
    //        throw ex;
    //    }
    //}

    protected void Btn_Cetak_Click(object sender, EventArgs e)
    {
       
            string constr = ConfigurationManager.ConnectionStrings["KSAIMBConnectionString"].ConnectionString;
            using (SqlConnection con = new SqlConnection(constr))
            {
                string sql;
            string txt = string.Empty;
            string vv1 = "[1]";
            string vv2 = "[2]";
            string vv3 = "[3]";
            string vv4 = "[4]";
            string vv5 = "[5]";
            string fmdate = string.Empty, tmdate = string.Empty;
            if (Tk_mula.Text != "")
            {
                string fdate = Tk_mula.Text;
                DateTime fd = DateTime.ParseExact(fdate, "dd/MM/yyyy", CultureInfo.InvariantCulture);
                fmdate = fd.ToString("yyyy-MM-dd");
            }
            if (Tk_akhir.Text != "")
            {
                string tdate = Tk_akhir.Text;
                DateTime td = DateTime.ParseExact(tdate, "dd/MM/yyyy", CultureInfo.InvariantCulture);
                tmdate = td.ToString("yyyy-MM-dd");
            }
            string carry = string.Empty;
            if (zero_bal.Checked == true)
            {
                carry = "1";
            }
            else
            {
                carry = "0";
            }
            if (fmdate != "" && tmdate != "")
            {
                //sqry1 = "select CONCAT(a1.vv_5a,'|',a1.vv_5b,'|',a1.vv_6a,'|',a1.vv_6b,'|',a1.vv_09,'|',a1.vv_10,'|',a1.vv_11,'|',a1.vv_12,'|',a1.vv_13,'|',a1.vv_14,'|',a1.vv_15,'|',a1.vv_16,'|',a1.vv_17,'|',a1.vv_18,'|', case when a2.[1] = '0' then '' else a2.[1] end,'|',a1.vv_5b,'|',case when a2.[2] = '0' then '' else a2.[2] end,'|','0.00','|',case when a2.[3] = '0' then '' else a2.[3] end,'|','0.00','|',case when a2.[4] = '0' then '' else a2.[4] end,'|','0.00','|',case when a2.[5] = '0' then '' else a2.[5] end,'|','0.00') from (select '01' as vv1,ISNULL(a.Amt1,'0.00') as vv_5a,  (ISNULL(a.Amt2,'0.00') + ISNULL(a1.Amt2,'0.00')) as vv_5b,ISNULL(b.Amt1,'0.00') as vv_6a,(ISNULL(b.Amt2,'0.00') + ISNULL(b1.Amt2,'0.00')) as vv_6b,'" + carry + "' as vv_09,ISNULL(c.Amt3,'0.00') as vv_10,ISNULL(d.Amt3,'0.00') as vv_11,ISNULL(e.Amt3,'0.00') as vv_12,ISNULL(f.Amt3,'0.00') as vv_13 ,ISNULL(g.Amt1,'0.00') as vv_14,ISNULL(g.Amt2,'0.00') as vv_15,ISNULL(h.Amt1,'0.00') as vv_16,ISNULL(I.Amt3,'0.00') as vv_17,ISNULL(J.Amt3,'0.00') as vv_18 from (select '01' as tid,(sum(Tot_Amt) - sum(m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '" + fmdate + "'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '" + tmdate + "'), +1) and  m1.Tax_type IN ('SR','DS') and m1.KW_Debit_amt='0.00') as a left join (select '01' as tid,(sum(Tot_Amt) - sum(m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '" + fmdate + "'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '" + tmdate + "'), +1) and  m1.Tax_type IN ('AJS') and m1.KW_Debit_amt='0.00') as a1 on a1.tid=a.tid left join (select '01' as tid,sum((case when  ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00') end - m1.KW_Debit_amt)) as Amt1,sum(m1.KW_Debit_amt) as Amt2,sum(case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else  ISNULL(m2.Overall,'0.00') end) as Amt3 from KW_General_Ledger m1 left join KW_Pembayaran_invoisBil_item m2 on m2.no_invois =m1.GL_invois_no left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join  KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '" + fmdate + "'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '" + tmdate + "'), +1) and m1.Tax_type IN ('TX','TX-CG','TX-IES','TX-RE','IM') and m1.KW_kredit_amt='0.00' ) as b on b.tid=a.tid left join (select '01' as tid,sum((case when  ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00') end - m1.KW_Debit_amt)) as Amt1,sum(m1.KW_Debit_amt) as Amt2,sum(case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else  ISNULL(m2.Overall,'0.00') end) as Amt3 from KW_General_Ledger m1 left join KW_Pembayaran_invoisBil_item m2 on m2.no_invois =m1.GL_invois_no left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join  KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '" + fmdate + "'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '" + tmdate + "'), +1) and m1.Tax_type IN ('AJP') and m1.KW_kredit_amt='0.00' ) as b1 on b1.tid=a.tid left join (select '01' as tid,sum((Tot_Amt - m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai= m1.Tax_type where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '" + fmdate + "'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '" + tmdate + "'), +1) and m1.Tax_type IN ('ZRL','ZDA') and m1.KW_Debit_amt='0.00') as c on c.tid=a.tid  left join (select '01' as tid,sum((Tot_Amt - m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from  KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '" + fmdate + "'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '" + tmdate + "'), +1) and m1.Tax_type IN ('ZRE') and m1.KW_Debit_amt='0.00') as d on d.tid=a.tid  left join(select '01' as tid,sum((Tot_Amt - m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '" + fmdate + "'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '" + tmdate + "'), +1) and m1.Tax_type IN ('ES','IES') and m1.KW_Debit_amt='0.00') as e on e.tid=a.tid  left join (select '01' as tid,sum((Tot_Amt -  m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type  where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '" + fmdate + "'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '" + tmdate + "'), +1) and m1.Tax_type IN ('RS','GS') and m1.KW_Debit_amt='0.00') as f on f.tid=a.tid left join(select '01' as tid,sum((case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else  ISNULL(m2.Overall,'0.00') end - m1.KW_Debit_amt)) as Amt1,sum(m1.KW_Debit_amt) as Amt2,sum(case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00') end) as Amt3 from KW_General_Ledger m1  left join KW_Pembayaran_invoisBil_item m2 on m2.no_invois =m1.GL_invois_no left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '" + fmdate + "'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '" + tmdate + "'), +1) and m1.Tax_type  IN ('IS') and m1.KW_kredit_amt='0.00' ) as g on g.tid=a.tid   left join(select '01' as tid,sum((case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00')  end - m1.KW_Debit_amt)) as Amt1,sum(m1.KW_Debit_amt) as Amt2,sum(case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00') end) as Amt3 from KW_General_Ledger m1 left join KW_Pembayaran_invoisBil_item  m2 on m2.no_invois =m1.GL_invois_no left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '" + fmdate + "'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '" + tmdate + "'), +1) and m1.Tax_type IN ('TX-CG') and m1.KW_kredit_amt='0.00' )  as h on h.tid=a.tid left join(select '01' as tid,sum((case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00')  end - m1.KW_Debit_amt)) as Amt1,sum(m1.KW_Debit_amt) as Amt2,sum(case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00') end) as Amt3 from KW_General_Ledger m1 left join KW_Pembayaran_invoisBil_item  m2 on m2.no_invois =m1.GL_invois_no left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '" + fmdate + "'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '" + tmdate + "'), +1) and m1.Tax_type IN ('AJS') and m1.KW_kredit_amt='0.00' )  as I on I.tid=a.tid left join (select '01' as tid,sum((case when  ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00') end - m1.KW_Debit_amt)) as Amt1,sum(m1.KW_Debit_amt) as Amt2,sum(case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else  ISNULL(m2.Overall,'0.00') end) as Amt3 from KW_General_Ledger m1 left join KW_Pembayaran_invoisBil_item m2 on m2.no_invois =m1.GL_invois_no left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join  KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '" + fmdate + "'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '" + tmdate + "'), +1) and m1.Tax_type IN ('AJP') and m1.KW_kredit_amt='0.00' ) as J on J.tid=a.tid) as a1 left join(SELECT '01' as s1,cast(Kod_industry as int) as val1,ID as t1 FROM Kw_kod_industry) AS SourceTable PIVOT(AVG([val1])  FOR [t1] IN(" + vv1 + "," + vv2 + "," + vv3 + "," + vv4 + "," + vv5 + ")) as a2 on a2.s1=a1.vv1";
                sqry1 = "select CONCAT(a1.vv_5a,'|',a1.vv_5b,'|',a1.vv_6a,'|',a1.vv_6b,'|',a1.vv_09,'|',a1.vv_10,'|',a1.vv_11,'|',a1.vv_12,'|',a1.vv_13,'|',a1.vv_14,'|',a1.vv_15,'|',a1.vv_16,'|',a1.vv_17,'|',a1.vv_18,'|', case when a2.[1] = '0' then '' else a2.[1] end,'|',a1.mm1,'|',case when a2.[2] = '0' then '' else a2.[2] end,'|',a1.mm2,'|',case when a2.[3] = '0' then '' else a2.[3] end,'|',a1.mm3,'|',case when a2.[4] = '0' then '' else a2.[4] end,'|',a1.mm4,'|',case when a2.[5] = '0' then '' else a2.[5] end,'|',a1.mm5) from (select '01' as vv1,ISNULL(a.Amt1,'0.00') as vv_5a,  (ISNULL(a.Amt2,'0.00') + ISNULL(a1.Amt2,'0.00')) as vv_5b,ISNULL(b.Amt1,'0.00') as vv_6a,(ISNULL(b.Amt2,'0.00') + ISNULL(b1.Amt2,'0.00')) as vv_6b,'0' as vv_09,ISNULL(c.Amt3,'0.00') as vv_10,ISNULL(d.Amt3,'0.00') as vv_11,ISNULL(e.Amt3,'0.00') as vv_12,ISNULL(f.Amt3,'0.00') as vv_13 ,ISNULL(g.Amt1,'0.00') as vv_14,ISNULL(g.Amt2,'0.00') as vv_15,ISNULL(h.Amt1,'0.00') as vv_16,ISNULL(I.Amt3,'0.00') as vv_17,ISNULL(J.Amt3,'0.00') as vv_18,(ISNULL(aa1.Amt2,'0.00') + ISNULL(ab1.Amt2,'0.00')) as mm1,(ISNULL(aa2.Amt2,'0.00') + ISNULL(ab2.Amt2,'0.00')) as mm2,(ISNULL(aa3.Amt2,'0.00') + ISNULL(ab3.Amt2,'0.00')) as mm3,(ISNULL(aa4.Amt2,'0.00') + ISNULL(ab4.Amt2,'0.00')) as mm4,(ISNULL(aa5.Amt2,'0.00') + ISNULL(ab5.Amt2,'0.00')) as mm5 from (select '01' as tid,(sum(Tot_Amt) - sum(m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '"+fmdate+"'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '"+tmdate+"'), +1) and  m1.Tax_type IN ('SR','DS') and m1.KW_Debit_amt='0.00') as a left join (select '01' as tid,(sum(Tot_Amt) - sum(m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '"+fmdate+"'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '"+tmdate+"'), +1) and  m1.Tax_type IN ('AJS') and m1.KW_Debit_amt='0.00') as a1 on a1.tid=a.tid left join (select '01' as tid,(sum(Tot_Amt) - sum(m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type left join Kw_kod_industry ki on ki.ID='1' and ISNULL(m1.GL_kod_industry,'') != '' where  m1.GL_kod_industry=ki.kod_industry and m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '"+fmdate+"'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '"+tmdate+"'), +1) and  m1.Tax_type IN ('SR','DS') and m1.KW_Debit_amt='0.00') as aa1 on aa1.tid=a.tid left join (select '01' as tid,(sum(Tot_Amt) - sum(m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type left join Kw_kod_industry ki on ki.ID='1' and ISNULL(m1.GL_kod_industry,'') != '' where m1.GL_kod_industry=ki.kod_industry and m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '"+fmdate+"'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '"+tmdate+"'), +1) and  m1.Tax_type IN ('AJS') and m1.KW_Debit_amt='0.00') as ab1 on ab1.tid=a.tid left join (select '01' as tid,(sum(Tot_Amt) - sum(m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type left join Kw_kod_industry ki on ki.ID='2' and ISNULL(m1.GL_kod_industry,'') != '' where  m1.GL_kod_industry=ki.kod_industry and m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '"+fmdate+"'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '"+tmdate+"'), +1) and  m1.Tax_type IN ('SR','DS') and m1.KW_Debit_amt='0.00') as aa2 on aa2.tid=a.tid left join (select '01' as tid,(sum(Tot_Amt) - sum(m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type left join Kw_kod_industry ki on ki.ID='2' and ISNULL(m1.GL_kod_industry,'') != '' where m1.GL_kod_industry=ki.kod_industry and m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '"+fmdate+"'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '"+tmdate+"'), +1) and  m1.Tax_type IN ('AJS') and m1.KW_Debit_amt='0.00') as ab2 on ab2.tid=a.tid left join (select '01' as tid,(sum(Tot_Amt) - sum(m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type left join Kw_kod_industry ki on ki.ID='3' and ISNULL(m1.GL_kod_industry,'') != '' where  m1.GL_kod_industry=ki.kod_industry and m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '"+fmdate+"'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '"+tmdate+"'), +1) and  m1.Tax_type IN ('SR','DS') and m1.KW_Debit_amt='0.00') as aa3 on aa3.tid=a.tid left join (select '01' as tid,(sum(Tot_Amt) - sum(m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type left join Kw_kod_industry ki on ki.ID='3' and ISNULL(m1.GL_kod_industry,'') != '' where m1.GL_kod_industry=ki.kod_industry and m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '"+fmdate+"'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '"+tmdate+"'), +1) and  m1.Tax_type IN ('AJS') and m1.KW_Debit_amt='0.00') as ab3 on ab3.tid=a.tid left join (select '01' as tid,(sum(Tot_Amt) - sum(m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type left join Kw_kod_industry ki on ki.ID='4' and ISNULL(m1.GL_kod_industry,'') != '' where  m1.GL_kod_industry=ki.kod_industry and m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '"+fmdate+"'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '"+tmdate+"'), +1) and  m1.Tax_type IN ('SR','DS') and m1.KW_Debit_amt='0.00') as aa4 on aa4.tid=a.tid left join (select '01' as tid,(sum(Tot_Amt) - sum(m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type left join Kw_kod_industry ki on ki.ID='4' and ISNULL(m1.GL_kod_industry,'') != '' where m1.GL_kod_industry=ki.kod_industry and m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '"+fmdate+"'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '"+tmdate+"'), +1) and  m1.Tax_type IN ('AJS') and m1.KW_Debit_amt='0.00') as ab4 on ab4.tid=a.tid left join (select '01' as tid,(sum(Tot_Amt) - sum(m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type left join Kw_kod_industry ki on ki.ID='5' and ISNULL(m1.GL_kod_industry,'') != '' where  m1.GL_kod_industry=ki.kod_industry and m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '"+fmdate+"'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '"+tmdate+"'), +1) and  m1.Tax_type IN ('SR','DS') and m1.KW_Debit_amt='0.00') as aa5 on aa5.tid=a.tid left join (select '01' as tid,(sum(Tot_Amt) - sum(m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type left join Kw_kod_industry ki on ki.ID='5' and ISNULL(m1.GL_kod_industry,'') != '' where m1.GL_kod_industry=ki.kod_industry and m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '"+fmdate+"'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '"+tmdate+"'), +1) and  m1.Tax_type IN ('AJS') and m1.KW_Debit_amt='0.00') as ab5 on ab5.tid=a.tid left join (select '01' as tid,sum((case when  ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00') end - m1.KW_Debit_amt)) as Amt1,sum(m1.KW_Debit_amt) as Amt2,sum(case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else  ISNULL(m2.Overall,'0.00') end) as Amt3 from KW_General_Ledger m1 left join KW_Pembayaran_invoisBil_item m2 on m2.no_invois =m1.GL_invois_no left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join  KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '"+fmdate+"'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '"+tmdate+"'), +1) and m1.Tax_type IN ('TX','TX-CG','TX-IES','TX-RE','IM') and m1.KW_kredit_amt='0.00' ) as b on b.tid=a.tid left join (select '01' as tid,sum((case when  ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00') end - m1.KW_Debit_amt)) as Amt1,sum(m1.KW_Debit_amt) as Amt2,sum(case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else  ISNULL(m2.Overall,'0.00') end) as Amt3 from KW_General_Ledger m1 left join KW_Pembayaran_invoisBil_item m2 on m2.no_invois =m1.GL_invois_no left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join  KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '"+fmdate+"'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '"+tmdate+"'), +1) and m1.Tax_type IN ('AJP') and m1.KW_kredit_amt='0.00' ) as b1 on b1.tid=a.tid left join (select '01' as tid,sum((Tot_Amt - m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai= m1.Tax_type where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '"+fmdate+"'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '"+tmdate+"'), +1) and m1.Tax_type IN ('ZRL','ZDA') and m1.KW_Debit_amt='0.00') as c on c.tid=a.tid  left join (select '01' as tid,sum((Tot_Amt - m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from  KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '"+fmdate+"'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '"+tmdate+"'), +1) and m1.Tax_type IN ('ZRE') and m1.KW_Debit_amt='0.00') as d on d.tid=a.tid  left join(select '01' as tid,sum((Tot_Amt - m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '"+fmdate+"'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '"+tmdate+"'), +1) and m1.Tax_type IN ('ES','IES') and m1.KW_Debit_amt='0.00') as e on e.tid=a.tid  left join (select '01' as tid,sum((Tot_Amt -  m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type  where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '"+fmdate+"'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '"+tmdate+"'), +1) and m1.Tax_type IN ('RS','GS') and m1.KW_Debit_amt='0.00') as f on f.tid=a.tid left join(select '01' as tid,sum((case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else  ISNULL(m2.Overall,'0.00') end - m1.KW_Debit_amt)) as Amt1,sum(m1.KW_Debit_amt) as Amt2,sum(case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00') end) as Amt3 from KW_General_Ledger m1  left join KW_Pembayaran_invoisBil_item m2 on m2.no_invois =m1.GL_invois_no left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '"+fmdate+"'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '"+tmdate+"'), +1) and m1.Tax_type  IN ('IS') and m1.KW_kredit_amt='0.00' ) as g on g.tid=a.tid   left join(select '01' as tid,sum((case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00')  end - m1.KW_Debit_amt)) as Amt1,sum(m1.KW_Debit_amt) as Amt2,sum(case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00') end) as Amt3 from KW_General_Ledger m1 left join KW_Pembayaran_invoisBil_item  m2 on m2.no_invois =m1.GL_invois_no left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '"+fmdate+"'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '"+tmdate+"'), +1) and m1.Tax_type IN ('TX-CG') and m1.KW_kredit_amt='0.00' )  as h on h.tid=a.tid left join(select '01' as tid,sum((case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00')  end - m1.KW_Debit_amt)) as Amt1,sum(m1.KW_Debit_amt) as Amt2,sum(case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00') end) as Amt3 from KW_General_Ledger m1 left join KW_Pembayaran_invoisBil_item  m2 on m2.no_invois =m1.GL_invois_no left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '"+fmdate+"'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '"+tmdate+"'), +1) and m1.Tax_type IN ('AJS') and m1.KW_kredit_amt='0.00' )  as I on I.tid=a.tid left join (select '01' as tid,sum((case when  ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00') end - m1.KW_Debit_amt)) as Amt1,sum(m1.KW_Debit_amt) as Amt2,sum(case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else  ISNULL(m2.Overall,'0.00') end) as Amt3 from KW_General_Ledger m1 left join KW_Pembayaran_invoisBil_item m2 on m2.no_invois =m1.GL_invois_no left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join  KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '"+fmdate+"'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '"+tmdate+"'), +1) and m1.Tax_type IN ('AJP') and m1.KW_kredit_amt='0.00' ) as J on J.tid=a.tid) as a1 left join(SELECT '01' as s1,cast(Kod_industry as int) as val1,ID as t1 FROM Kw_kod_industry) AS SourceTable PIVOT(AVG([val1])  FOR [t1] IN([1],[2],[3],[4],[5])) as a2 on a2.s1=a1.vv1 ";
            }
            else
            {
                sqry1 = "select CONCAT(a1.vv_5a,'|',a1.vv_5b,'|',a1.vv_6a,'|',a1.vv_6b,'|',a1.vv_09,'|',a1.vv_10,'|',a1.vv_11,'|',a1.vv_12,'|',a1.vv_13,'|',a1.vv_14,'|',a1.vv_15,'|',a1.vv_16,'|',a1.vv_17,'|',a1.vv_18,'|', case when a2.[1] = '0' then '' else a2.[1] end,'|',a1.mm1,'|',case when a2.[2] = '0' then '' else a2.[2] end,'|',a1.mm2,'|',case when a2.[3] = '0' then '' else a2.[3] end,'|',a1.mm3,'|',case when a2.[4] = '0' then '' else a2.[4] end,'|',a1.mm4,'|',case when a2.[5] = '0' then '' else a2.[5] end,'|',a1.mm5) from (select '01' as vv1,ISNULL(a.Amt1,'0.00') as vv_5a,  (ISNULL(a.Amt2,'0.00') + ISNULL(a1.Amt2,'0.00')) as vv_5b,ISNULL(b.Amt1,'0.00') as vv_6a,(ISNULL(b.Amt2,'0.00') + ISNULL(b1.Amt2,'0.00')) as vv_6b,'0' as vv_09,ISNULL(c.Amt3,'0.00') as vv_10,ISNULL(d.Amt3,'0.00') as vv_11,ISNULL(e.Amt3,'0.00') as vv_12,ISNULL(f.Amt3,'0.00') as vv_13 ,ISNULL(g.Amt1,'0.00') as vv_14,ISNULL(g.Amt2,'0.00') as vv_15,ISNULL(h.Amt1,'0.00') as vv_16,ISNULL(I.Amt3,'0.00') as vv_17,ISNULL(J.Amt3,'0.00') as vv_18,(ISNULL(aa1.Amt2,'0.00') + ISNULL(ab1.Amt2,'0.00')) as mm1,(ISNULL(aa2.Amt2,'0.00') + ISNULL(ab2.Amt2,'0.00')) as mm2,(ISNULL(aa3.Amt2,'0.00') + ISNULL(ab3.Amt2,'0.00')) as mm3,(ISNULL(aa4.Amt2,'0.00') + ISNULL(ab4.Amt2,'0.00')) as mm4,(ISNULL(aa5.Amt2,'0.00') + ISNULL(ab5.Amt2,'0.00')) as mm5 from (select '01' as tid,(sum(Tot_Amt) - sum(m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.Tax_type IN ('SR','DS') and m1.KW_Debit_amt='0.00') as a left join (select '01' as tid,(sum(Tot_Amt) - sum(m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.Tax_type IN ('AJS') and m1.KW_Debit_amt='0.00') as a1 on a1.tid=a.tid left join (select '01' as tid,(sum(Tot_Amt) - sum(m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type left join Kw_kod_industry ki on ki.ID='1' and ISNULL(m1.GL_kod_industry,'') != '' where  m1.GL_kod_industry=ki.kod_industry and  m1.Tax_type IN ('SR','DS') and m1.KW_Debit_amt='0.00') as aa1 on aa1.tid=a.tid left join (select '01' as tid,(sum(Tot_Amt) - sum(m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type left join Kw_kod_industry ki on ki.ID='1' and ISNULL(m1.GL_kod_industry,'') != '' where m1.GL_kod_industry=ki.kod_industry and  m1.Tax_type IN ('AJS') and m1.KW_Debit_amt='0.00') as ab1 on ab1.tid=a.tid left join (select '01' as tid,(sum(Tot_Amt) - sum(m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type left join Kw_kod_industry ki on ki.ID='2' and ISNULL(m1.GL_kod_industry,'') != '' where  m1.GL_kod_industry=ki.kod_industry and  m1.Tax_type IN ('SR','DS') and m1.KW_Debit_amt='0.00') as aa2 on aa2.tid=a.tid left join (select '01' as tid,(sum(Tot_Amt) - sum(m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type left join Kw_kod_industry ki on ki.ID='2' and ISNULL(m1.GL_kod_industry,'') != '' where m1.GL_kod_industry=ki.kod_industry and  m1.Tax_type IN ('AJS') and m1.KW_Debit_amt='0.00') as ab2 on ab2.tid=a.tid left join (select '01' as tid,(sum(Tot_Amt) - sum(m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type left join Kw_kod_industry ki on ki.ID='3' and ISNULL(m1.GL_kod_industry,'') != '' where  m1.GL_kod_industry=ki.kod_industry and  m1.Tax_type IN ('SR','DS') and m1.KW_Debit_amt='0.00') as aa3 on aa3.tid=a.tid left join (select '01' as tid,(sum(Tot_Amt) - sum(m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type left join Kw_kod_industry ki on ki.ID='3' and ISNULL(m1.GL_kod_industry,'') != '' where m1.GL_kod_industry=ki.kod_industry and m1.Tax_type IN ('AJS') and m1.KW_Debit_amt='0.00') as ab3 on ab3.tid=a.tid left join (select '01' as tid,(sum(Tot_Amt) - sum(m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type left join Kw_kod_industry ki on ki.ID='4' and ISNULL(m1.GL_kod_industry,'') != '' where  m1.GL_kod_industry=ki.kod_industry and  m1.Tax_type IN ('SR','DS') and m1.KW_Debit_amt='0.00') as aa4 on aa4.tid=a.tid left join (select '01' as tid,(sum(Tot_Amt) - sum(m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type left join Kw_kod_industry ki on ki.ID='4' and ISNULL(m1.GL_kod_industry,'') != '' where m1.GL_kod_industry=ki.kod_industry and m1.Tax_type IN ('AJS') and m1.KW_Debit_amt='0.00') as ab4 on ab4.tid=a.tid left join (select '01' as tid,(sum(Tot_Amt) - sum(m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type left join Kw_kod_industry ki on ki.ID='5' and ISNULL(m1.GL_kod_industry,'') != '' where  m1.GL_kod_industry=ki.kod_industry and  m1.Tax_type IN ('SR','DS') and m1.KW_Debit_amt='0.00') as aa5 on aa5.tid=a.tid left join (select '01' as tid,(sum(Tot_Amt) - sum(m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type left join Kw_kod_industry ki on ki.ID='5' and ISNULL(m1.GL_kod_industry,'') != '' where m1.GL_kod_industry=ki.kod_industry   and  m1.Tax_type IN ('AJS') and m1.KW_Debit_amt='0.00') as ab5 on ab5.tid=a.tid left join (select '01' as tid,sum((case when  ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00') end - m1.KW_Debit_amt)) as Amt1,sum(m1.KW_Debit_amt) as Amt2,sum(case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else  ISNULL(m2.Overall,'0.00') end) as Amt3 from KW_General_Ledger m1 left join KW_Pembayaran_invoisBil_item m2 on m2.no_invois =m1.GL_invois_no left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join  KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.Tax_type IN ('TX','TX-CG','TX-IES','TX-RE','IM') and m1.KW_kredit_amt='0.00' ) as b on b.tid=a.tid left join (select '01' as tid,sum((case when  ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00') end - m1.KW_Debit_amt)) as Amt1,sum(m1.KW_Debit_amt) as Amt2,sum(case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else  ISNULL(m2.Overall,'0.00') end) as Amt3 from KW_General_Ledger m1 left join KW_Pembayaran_invoisBil_item m2 on m2.no_invois =m1.GL_invois_no left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join  KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.Tax_type IN ('AJP') and m1.KW_kredit_amt='0.00' ) as b1 on b1.tid=a.tid left join (select '01' as tid,sum((Tot_Amt - m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai= m1.Tax_type where m1.Tax_type IN ('ZRL','ZDA') and m1.KW_Debit_amt='0.00') as c on c.tid=a.tid  left join (select '01' as tid,sum((Tot_Amt - m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from  KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.Tax_type IN ('ZRE') and m1.KW_Debit_amt='0.00') as d on d.tid=a.tid  left join(select '01' as tid,sum((Tot_Amt - m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where  m1.Tax_type IN ('ES','IES') and m1.KW_Debit_amt='0.00') as e on e.tid=a.tid  left join (select '01' as tid,sum((Tot_Amt -  m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type  where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '2019-02-01'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '2019-02-28'), +1) and m1.Tax_type IN ('RS','GS') and m1.KW_Debit_amt='0.00') as f on f.tid=a.tid left join(select '01' as tid,sum((case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else  ISNULL(m2.Overall,'0.00') end - m1.KW_Debit_amt)) as Amt1,sum(m1.KW_Debit_amt) as Amt2,sum(case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00') end) as Amt3 from KW_General_Ledger m1  left join KW_Pembayaran_invoisBil_item m2 on m2.no_invois =m1.GL_invois_no left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.Tax_type  IN ('IS') and m1.KW_kredit_amt='0.00' ) as g on g.tid=a.tid   left join(select '01' as tid,sum((case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00')  end - m1.KW_Debit_amt)) as Amt1,sum(m1.KW_Debit_amt) as Amt2,sum(case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00') end) as Amt3 from KW_General_Ledger m1 left join KW_Pembayaran_invoisBil_item  m2 on m2.no_invois =m1.GL_invois_no left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.Tax_type IN ('TX-CG') and m1.KW_kredit_amt='0.00' )  as h on h.tid=a.tid left join(select '01' as tid,sum((case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00')  end - m1.KW_Debit_amt)) as Amt1,sum(m1.KW_Debit_amt) as Amt2,sum(case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00') end) as Amt3 from KW_General_Ledger m1 left join KW_Pembayaran_invoisBil_item  m2 on m2.no_invois =m1.GL_invois_no left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.Tax_type IN ('AJS') and m1.KW_kredit_amt='0.00' )  as I on I.tid=a.tid left join (select '01' as tid,sum((case when  ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00') end - m1.KW_Debit_amt)) as Amt1,sum(m1.KW_Debit_amt) as Amt2,sum(case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else  ISNULL(m2.Overall,'0.00') end) as Amt3 from KW_General_Ledger m1 left join KW_Pembayaran_invoisBil_item m2 on m2.no_invois =m1.GL_invois_no left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join  KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.Tax_type IN ('AJP') and m1.KW_kredit_amt='0.00' ) as J on J.tid=a.tid) as a1 left join(SELECT '01' as s1,cast(Kod_industry as int) as val1,ID as t1 FROM Kw_kod_industry) AS SourceTable PIVOT(AVG([val1])  FOR [t1] IN([1],[2],[3],[4],[5])) as a2 on a2.s1=a1.vv1 ";

            }

            using (SqlCommand cmd1 = new SqlCommand(sqry1))
                                        {
                                            using (SqlDataAdapter sda1 = new SqlDataAdapter())
                                            {
                                                cmd1.Connection = con;
                                                sda1.SelectCommand = cmd1;
                                                using (DataTable dt1 = new DataTable())
                                                {
                                                    sda1.Fill(dt1);

                                                    //Build the Text file data.
                                                    //string txt = string.Empty;

                                                    //foreach (DataColumn column in dt.Columns)
                                                    //{
                                                    //    //Add the Header row for Text file.
                                                    //    txt += column.ColumnName + "\t\t";
                                                    //}

                                                    //Add new line.
                                                    //txt += "\r\n";

                                                    foreach (DataRow row1 in dt1.Rows)
                                                    {
                                                        foreach (DataColumn column1 in dt1.Columns)
                                                        {
                                                            //Add the Data rows.
                                                            txt += row1[column1.ColumnName].ToString() + "\t\t";
                                                            txt += "\r\n";
                                                        }

                                                        //Add new line.

                                                    }

                                                }
                                            }
                                        }
                                   
                                string filename1 = "GST_03" + DateTime.Now.ToString("yyyyMMddHHmmss");
                              
                                //Download the Text file.
                                Response.Clear();
                                Response.Buffer = true;
                                Response.AddHeader("content-disposition", "attachment;filename=" + filename1 + ".txt");
                                Response.Charset = "";
                                Response.ContentType = "application/text";
                                Response.Output.Write(txt);
                                Response.Flush();
                                Response.End();
                            }
                                                  
       
    }

    protected void clk_submit(object sender, EventArgs e)
    {
        string rcount = string.Empty, rcount1 = string.Empty;
        int count = 0, count1 = 1;
       

        DataSet ds = new DataSet();
        DataSet ds1 = new DataSet();
        DataTable dt = new DataTable();
        DataTable dt1 = new DataTable();
        string fmdate = string.Empty, tmdate = string.Empty;
        if (Tk_mula.Text != "")
        {
            string fdate = Tk_mula.Text;
            DateTime fd = DateTime.ParseExact(fdate, "dd/MM/yyyy", CultureInfo.InvariantCulture);
            fmdate = fd.ToString("yyyy-MM-dd");
        }
        if (Tk_akhir.Text != "")
        {
            string tdate = Tk_akhir.Text;
            DateTime td = DateTime.ParseExact(tdate, "dd/MM/yyyy", CultureInfo.InvariantCulture);
            tmdate = td.ToString("yyyy-MM-dd");
        }

        if (fmdate == "" && tmdate == "")
        {
            sqry1 = "select ISNULL(a.Amt1,'0.00') as vv_5a, (ISNULL(a.Amt2,'0.00') + ISNULL(a1.Amt2,'0.00')) as vv_5b,ISNULL(b.Amt1,'0.00') as vv_6a,(ISNULL(b.Amt2,'0.00') + ISNULL(b1.Amt2,'0.00')) as vv_6b,(ISNULL(a.Amt2,'0.00') - ISNULL(b.Amt2,'0.00')) as vv_07,(ISNULL(b.Amt2,'0.00') - ISNULL(a.Amt2,'0.00')) as vv_08,ISNULL(c.Amt3,'0.00') as vv_10,ISNULL(d.Amt3,'0.00') as vv_11,ISNULL(e.Amt3,'0.00') as vv_12,ISNULL(f.Amt3,'0.00') as vv_13 ,ISNULL(g.Amt1,'0.00') as vv_14,ISNULL(g.Amt2,'0.00') as vv_15,ISNULL(h.Amt1,'0.00') as vv_16,ISNULL(I.Amt3,'0.00') as vv_17,ISNULL(J.Amt3,'0.00') as vv_18 from (select '01' as tid,(sum(Tot_Amt) - sum(m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where  m1.Tax_type IN ('SR','DS') and m1.KW_Debit_amt='0.00') as a left join (select '01' as tid,(sum(Tot_Amt) - sum(m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '" + fmdate + "'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '" + tmdate + "'), +1) and  m1.Tax_type IN ('AJS') and m1.KW_Debit_amt='0.00') as a1 on a1.tid=a.tid left join (select '01' as tid,sum((case when  ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00') end - m1.KW_Debit_amt)) as Amt1,sum(m1.KW_Debit_amt) as Amt2,sum(case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else  ISNULL(m2.Overall,'0.00') end) as Amt3 from KW_General_Ledger m1 left join KW_Pembayaran_invoisBil_item m2 on m2.no_invois =m1.GL_invois_no left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join  KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.Tax_type IN ('TX','TX-CG','TX-IES','TX-RE','IM') and m1.KW_kredit_amt='0.00' ) as b on b.tid=a.tid left join (select '01' as tid,sum((case when  ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00') end - m1.KW_Debit_amt)) as Amt1,sum(m1.KW_Debit_amt) as Amt2,sum(case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else  ISNULL(m2.Overall,'0.00') end) as Amt3 from KW_General_Ledger m1 left join KW_Pembayaran_invoisBil_item m2 on m2.no_invois =m1.GL_invois_no left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join  KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where  m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '" + fmdate + "'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '" + tmdate + "'), +1) and m1.Tax_type IN ('AJP') and m1.KW_kredit_amt='0.00' ) as b1 on b1.tid=a.tid left join (select '01' as tid,sum((Tot_Amt - m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai= m1.Tax_type where m1.Tax_type IN ('ZRL','ZDA') and m1.KW_Debit_amt='0.00') as c on c.tid=a.tid  left join (select '01' as tid,sum((Tot_Amt - m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from  KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.Tax_type IN ('ZRE') and m1.KW_Debit_amt='0.00') as d on d.tid=a.tid  left join(select '01' as tid,sum((Tot_Amt - m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.Tax_type IN ('ES','IES') and m1.KW_Debit_amt='0.00') as e on e.tid=a.tid  left join (select '01' as tid,sum((Tot_Amt -  m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type  where m1.Tax_type IN ('RS','GS') and m1.KW_Debit_amt='0.00') as f on f.tid=a.tid left join(select '01' as tid,sum((case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else  ISNULL(m2.Overall,'0.00') end - m1.KW_Debit_amt)) as Amt1,sum(m1.KW_Debit_amt) as Amt2,sum(case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00') end) as Amt3 from KW_General_Ledger m1  left join KW_Pembayaran_invoisBil_item m2 on m2.no_invois =m1.GL_invois_no left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.Tax_type  IN ('IS') and m1.KW_kredit_amt='0.00' ) as g on g.tid=a.tid left join(select '01' as tid,sum((case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00')  end - m1.KW_Debit_amt)) as Amt1,sum(m1.KW_Debit_amt) as Amt2,sum(case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00') end) as Amt3 from KW_General_Ledger m1 left join KW_Pembayaran_invoisBil_item  m2 on m2.no_invois =m1.GL_invois_no left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.Tax_type IN ('TX-CG') and m1.KW_kredit_amt='0.00' )  as h on h.tid=a.tid left join(select '01' as tid,sum((case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00')  end - m1.KW_Debit_amt)) as Amt1,sum(m1.KW_Debit_amt) as Amt2,sum(case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00') end) as Amt3 from KW_General_Ledger m1 left join KW_Pembayaran_invoisBil_item  m2 on m2.no_invois =m1.GL_invois_no left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.Tax_type IN ('AJS') and m1.KW_kredit_amt='0.00' )  as I on I.tid=a.tid left join (select '01' as tid,sum((case when  ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00') end - m1.KW_Debit_amt)) as Amt1,sum(m1.KW_Debit_amt) as Amt2,sum(case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else  ISNULL(m2.Overall,'0.00') end) as Amt3 from KW_General_Ledger m1 left join KW_Pembayaran_invoisBil_item m2 on m2.no_invois =m1.GL_invois_no left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join  KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.Tax_type IN ('AJP') and m1.KW_kredit_amt='0.00' ) as J on J.tid=a.tid";
        }
        else if (fmdate != "" && tmdate != "")
        {
            sqry1 = "select ISNULL(a.Amt1,'0.00') as vv_5a,  (ISNULL(a.Amt2,'0.00') + ISNULL(a1.Amt2,'0.00')) as vv_5b,ISNULL(b.Amt1,'0.00') as vv_6a,(ISNULL(b.Amt2,'0.00') + ISNULL(b1.Amt2,'0.00')) as vv_6b,(ISNULL(a.Amt2,'0.00') - ISNULL(b.Amt2,'0.00')) as vv_07,(ISNULL(b.Amt2,'0.00') - ISNULL(a.Amt2,'0.00')) as vv_08,ISNULL(c.Amt3,'0.00') as vv_10,ISNULL(d.Amt3,'0.00') as vv_11,ISNULL(e.Amt3,'0.00') as vv_12,ISNULL(f.Amt3,'0.00') as vv_13 ,ISNULL(g.Amt1,'0.00') as vv_14,ISNULL(g.Amt2,'0.00') as vv_15,ISNULL(h.Amt1,'0.00') as vv_16,ISNULL(I.Amt3,'0.00') as vv_17,ISNULL(J.Amt3,'0.00') as vv_18 from (select '01' as tid,(sum(Tot_Amt) - sum(m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '" + fmdate + "'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '" + tmdate + "'), +1) and  m1.Tax_type IN ('SR','DS') and m1.KW_Debit_amt='0.00') as a left join (select '01' as tid,(sum(Tot_Amt) - sum(m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '"+fmdate+"'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '"+tmdate+"'), +1) and  m1.Tax_type IN ('AJS') and m1.KW_Debit_amt='0.00') as a1 on a1.tid=a.tid left join (select '01' as tid,sum((case when  ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00') end - m1.KW_Debit_amt)) as Amt1,sum(m1.KW_Debit_amt) as Amt2,sum(case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else  ISNULL(m2.Overall,'0.00') end) as Amt3 from KW_General_Ledger m1 left join KW_Pembayaran_invoisBil_item m2 on m2.no_invois =m1.GL_invois_no left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join  KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '" + fmdate + "'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '" + tmdate + "'), +1) and m1.Tax_type IN ('TX','TX-CG','TX-IES','TX-RE','IM') and m1.KW_kredit_amt='0.00' ) as b on b.tid=a.tid left join (select '01' as tid,sum((case when  ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00') end - m1.KW_Debit_amt)) as Amt1,sum(m1.KW_Debit_amt) as Amt2,sum(case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else  ISNULL(m2.Overall,'0.00') end) as Amt3 from KW_General_Ledger m1 left join KW_Pembayaran_invoisBil_item m2 on m2.no_invois =m1.GL_invois_no left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join  KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '" + fmdate + "'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '" + tmdate + "'), +1) and m1.Tax_type IN ('AJP') and m1.KW_kredit_amt='0.00' ) as b1 on b1.tid=a.tid left join (select '01' as tid,sum((Tot_Amt - m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai= m1.Tax_type where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '" + fmdate + "'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '" + tmdate + "'), +1) and m1.Tax_type IN ('ZRL','ZDA') and m1.KW_Debit_amt='0.00') as c on c.tid=a.tid  left join (select '01' as tid,sum((Tot_Amt - m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from  KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '" + fmdate + "'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '" + tmdate + "'), +1) and m1.Tax_type IN ('ZRE') and m1.KW_Debit_amt='0.00') as d on d.tid=a.tid  left join(select '01' as tid,sum((Tot_Amt - m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '" + fmdate + "'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '" + tmdate + "'), +1) and m1.Tax_type IN ('ES','IES') and m1.KW_Debit_amt='0.00') as e on e.tid=a.tid  left join (select '01' as tid,sum((Tot_Amt -  m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type  where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '" + fmdate + "'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '" + tmdate + "'), +1) and m1.Tax_type IN ('RS','GS') and m1.KW_Debit_amt='0.00') as f on f.tid=a.tid left join(select '01' as tid,sum((case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else  ISNULL(m2.Overall,'0.00') end - m1.KW_Debit_amt)) as Amt1,sum(m1.KW_Debit_amt) as Amt2,sum(case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00') end) as Amt3 from KW_General_Ledger m1  left join KW_Pembayaran_invoisBil_item m2 on m2.no_invois =m1.GL_invois_no left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '" + fmdate + "'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '" + tmdate + "'), +1) and m1.Tax_type  IN ('IS') and m1.KW_kredit_amt='0.00' ) as g on g.tid=a.tid   left join(select '01' as tid,sum((case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00')  end - m1.KW_Debit_amt)) as Amt1,sum(m1.KW_Debit_amt) as Amt2,sum(case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00') end) as Amt3 from KW_General_Ledger m1 left join KW_Pembayaran_invoisBil_item  m2 on m2.no_invois =m1.GL_invois_no left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '" + fmdate + "'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '" + tmdate + "'), +1) and m1.Tax_type IN ('TX-CG') and m1.KW_kredit_amt='0.00' )  as h on h.tid=a.tid left join(select '01' as tid,sum((case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00')  end - m1.KW_Debit_amt)) as Amt1,sum(m1.KW_Debit_amt) as Amt2,sum(case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00') end) as Amt3 from KW_General_Ledger m1 left join KW_Pembayaran_invoisBil_item  m2 on m2.no_invois =m1.GL_invois_no left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '" + fmdate + "'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '" + tmdate + "'), +1) and m1.Tax_type IN ('AJS') and m1.KW_kredit_amt='0.00' )  as I on I.tid=a.tid left join (select '01' as tid,sum((case when  ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00') end - m1.KW_Debit_amt)) as Amt1,sum(m1.KW_Debit_amt) as Amt2,sum(case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else  ISNULL(m2.Overall,'0.00') end) as Amt3 from KW_General_Ledger m1 left join KW_Pembayaran_invoisBil_item m2 on m2.no_invois =m1.GL_invois_no left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join  KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '" + fmdate + "'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '" + tmdate + "'), +1) and m1.Tax_type IN ('AJP') and m1.KW_kredit_amt='0.00' ) as J on J.tid=a.tid";
        }
        else
        {
            sqry1 = "select ISNULL(a.Amt1,'0.00') as vv_5a,  (ISNULL(a.Amt2,'0.00') + ISNULL(a1.Amt2,'0.00')) as vv_5b,ISNULL(b.Amt1,'0.00') as vv_6a,(ISNULL(b.Amt2,'0.00') + ISNULL(b1.Amt2,'0.00')) as vv_6b,(ISNULL(a.Amt2,'0.00') - ISNULL(b.Amt2,'0.00')) as vv_07,(ISNULL(b.Amt2,'0.00') - ISNULL(a.Amt2,'0.00')) as vv_08,ISNULL(c.Amt3,'0.00') as vv_10,ISNULL(d.Amt3,'0.00') as vv_11,ISNULL(e.Amt3,'0.00') as vv_12,ISNULL(f.Amt3,'0.00') as vv_13 ,ISNULL(g.Amt1,'0.00') as vv_14,ISNULL(g.Amt2,'0.00') as vv_15,ISNULL(h.Amt1,'0.00') as vv_16,ISNULL(I.Amt3,'0.00') as vv_17,ISNULL(J.Amt3,'0.00') as vv_18 from (select '01' as tid,(sum(Tot_Amt) - sum(m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where  m1.Tax_type IN ('SR','DS') and m1.KW_Debit_amt='0.00') as a left join (select '01' as tid,(sum(Tot_Amt) - sum(m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '" + fmdate + "'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '" + tmdate + "'), +1) and  m1.Tax_type IN ('AJS') and m1.KW_Debit_amt='0.00') as a1 on a1.tid=a.tid left join (select '01' as tid,sum((case when  ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00') end - m1.KW_Debit_amt)) as Amt1,sum(m1.KW_Debit_amt) as Amt2,sum(case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else  ISNULL(m2.Overall,'0.00') end) as Amt3 from KW_General_Ledger m1 left join KW_Pembayaran_invoisBil_item m2 on m2.no_invois =m1.GL_invois_no left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join  KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.Tax_type IN ('TX','TX-CG','TX-IES','TX-RE','IM') and m1.KW_kredit_amt='0.00' ) as b on b.tid=a.tid left join (select '01' as tid,sum((case when  ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00') end - m1.KW_Debit_amt)) as Amt1,sum(m1.KW_Debit_amt) as Amt2,sum(case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else  ISNULL(m2.Overall,'0.00') end) as Amt3 from KW_General_Ledger m1 left join KW_Pembayaran_invoisBil_item m2 on m2.no_invois =m1.GL_invois_no left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join  KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.GL_process_dt>=DATEADD(day, DATEDIFF(day, 0, '" + fmdate + "'), 0) and m1.GL_process_dt<=DATEADD(day, DATEDIFF(day, 0, '" + tmdate + "'), +1) and m1.Tax_type IN ('AJP') and m1.KW_kredit_amt='0.00' ) as b1 on b1.tid=a.tid left join (select '01' as tid,sum((Tot_Amt - m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai= m1.Tax_type where m1.Tax_type IN ('ZRL','ZDA') and m1.KW_Debit_amt='0.00') as c on c.tid=a.tid  left join (select '01' as tid,sum((Tot_Amt - m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from  KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.Tax_type IN ('ZRE') and m1.KW_Debit_amt='0.00') as d on d.tid=a.tid  left join(select '01' as tid,sum((Tot_Amt - m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod  left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.Tax_type IN ('ES','IES') and m1.KW_Debit_amt='0.00') as e on e.tid=a.tid  left join (select '01' as tid,sum((Tot_Amt -  m1.KW_kredit_amt)) as Amt1,sum(m1.KW_kredit_amt) as Amt2,sum(Tot_Amt) as Amt3 from KW_General_Ledger m1 left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type  where m1.Tax_type IN ('RS','GS') and m1.KW_Debit_amt='0.00') as f on f.tid=a.tid left join(select '01' as tid,sum((case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else  ISNULL(m2.Overall,'0.00') end - m1.KW_Debit_amt)) as Amt1,sum(m1.KW_Debit_amt) as Amt2,sum(case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00') end) as Amt3 from KW_General_Ledger m1  left join KW_Pembayaran_invoisBil_item m2 on m2.no_invois =m1.GL_invois_no left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.Tax_type  IN ('IS') and m1.KW_kredit_amt='0.00' ) as g on g.tid=a.tid left join(select '01' as tid,sum((case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00')  end - m1.KW_Debit_amt)) as Amt1,sum(m1.KW_Debit_amt) as Amt2,sum(case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00') end) as Amt3 from KW_General_Ledger m1 left join KW_Pembayaran_invoisBil_item  m2 on m2.no_invois =m1.GL_invois_no left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.Tax_type IN ('TX-CG') and m1.KW_kredit_amt='0.00' )  as h on h.tid=a.tid left join(select '01' as tid,sum((case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00')  end - m1.KW_Debit_amt)) as Amt1,sum(m1.KW_Debit_amt) as Amt2,sum(case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00') end) as Amt3 from KW_General_Ledger m1 left join KW_Pembayaran_invoisBil_item  m2 on m2.no_invois =m1.GL_invois_no left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.Tax_type IN ('AJS') and m1.KW_kredit_amt='0.00' )  as I on I.tid=a.tid left join (select '01' as tid,sum((case when  ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else ISNULL(m2.Overall,'0.00') end - m1.KW_Debit_amt)) as Amt1,sum(m1.KW_Debit_amt) as Amt2,sum(case when ISNULL(m2.Overall,'0.00') = '0.00' then m1.Tot_Amt else  ISNULL(m2.Overall,'0.00') end) as Amt3 from KW_General_Ledger m1 left join KW_Pembayaran_invoisBil_item m2 on m2.no_invois =m1.GL_invois_no left join KW_Ref_Carta_Akaun s1 on s1.kod_akaun=m1.GL_nama_kod left join  KW_Ref_Tetapan_cukai s2 on s2.Ref_kod_cukai=m1.Tax_type where m1.Tax_type IN ('AJP') and m1.KW_kredit_amt='0.00' ) as J on J.tid=a.tid";

        }

        dt = DBCon.Ora_Execute_table(sqry1);
        //dt1 = DBCon.Ora_Execute_table(sqry2);
        ds.Tables.Add(dt);
        //ds1.Tables.Add(dt1);

        string vs1 = string.Empty, vs2 = string.Empty, vs3 = string.Empty, vs4 = string.Empty, vs5 = string.Empty, vs6 = string.Empty;

        Rptviwerlejar.Reset();
        Rptviwerlejar.LocalReport.Refresh();
        List<DataRow> listResult = dt.AsEnumerable().ToList();
        listResult.Count();
        int countRow = 0;
        countRow = listResult.Count();
        string carry = string.Empty;
        if(zero_bal.Checked == true)
        {
            carry = "Yes";
        }
        else
        {
            carry = "No";
        }

        Rptviwerlejar.LocalReport.DataSources.Clear();
        if (countRow != 0)
        {
            DataTable cnt_open = new DataTable();
            cnt_open = DBCon.Ora_Execute_table(sqry2);

            Rptviwerlejar.LocalReport.ReportPath = "Kewengan/KW_GST_sum.rdlc";
            ReportDataSource rds = new ReportDataSource("kwgstsum", dt);
            //ReportDataSource rds1 = new ReportDataSource("kwlegar1", dt1);
            ReportParameter[] rptParams = new ReportParameter[]{
                     new ReportParameter("s1", Tk_mula.Text),
                     new ReportParameter("s2", Tk_akhir.Text),
                     new ReportParameter("s3", carry),
                     new ReportParameter("s4", ""),
                     new ReportParameter("S5", "")
                          };

            Rptviwerlejar.LocalReport.SetParameters(rptParams);
            Rptviwerlejar.LocalReport.DataSources.Add(rds);
            //Rptviwerlejar.LocalReport.DataSources.Add(rds1);
            Rptviwerlejar.LocalReport.DisplayName = "GST-03_Summary_" + DateTime.Now.ToString("yyyyMMdd");
            Rptviwerlejar.LocalReport.Refresh();

        }
        else
        {
            ScriptManager.RegisterStartupScript(this, GetType(), "alertMessage", "$.Zebra_Dialog('Rekod tidak dijumpai. Sila Pastikan Semua Maklumat Dimasukkan Dengan Betul.',{'type': 'warning','title': 'warning','auto_close': 2000});", true);
        }
    }



    protected void btn_reset(object sender, EventArgs e)
    {
        Response.Redirect("../kewengan/kw_lep_gst_summary.aspx");
    }


}